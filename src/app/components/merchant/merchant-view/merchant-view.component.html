<ng-container *ngIf="merchant">
  <div class="flex justify-content-between flex-wrap">
    <div class="flex flex-column">
      <h1>{{ merchant.name }}</h1>
    </div>
    <div class="flex align-items-center">
      <p-button icon="pi pi-file-edit" styleClass="p-button-outlined mr-2"
                [routerLink]="['/merchant', merchant.id, 'edit']"></p-button>
        <p-button icon="pi pi-trash" styleClass="p-button-outlined p-button-danger"
                  (click)="confirmDelete($event)"></p-button> <!-- TODO hide if not owner -->
        <p-confirmPopup></p-confirmPopup>
    </div>
  </div>
  <h3 class="mt-0">Details</h3>
  <div class="grid">
    <div class="col-12 md:col-6">
      <ul class="list-none m-0 p-0">
        <li class="flex flex-wrap my-2">
          <span class="text-800 w-4 md:w-2">Identifier</span>
          <span>{{ merchant.identifier }}</span>
        </li>
        <li class="flex flex-wrap my-2">
          <span class="text-800 w-4 md:w-2">Website</span>
          <span><a class="no-underline" [href]="merchant.website" target="_blank">{{ merchant.website || '-' }}</a></span>
        </li>
        <li class="flex flex-wrap my-2">
          <span class="text-800 w-4 md:w-2">Active</span>
          <span>{{ merchant.isActive }}</span>
        </li>
        <li class="flex flex-wrap my-2">
          <span class="text-800 w-4 md:w-2">Created by</span>
          <span>{{ merchant.createdBy?.username }}</span>
        </li>
        <li class="flex flex-wrap my-2">
          <span class="text-800 w-4 md:w-2">Created on</span>
          <span>{{ merchant.createdOn | date: "medium" }}</span>
        </li>
        <li class="flex flex-wrap my-2">
          <span class="text-800 w-4 md:w-2">Updated on</span>
          <span>{{ merchant.updatedOn | date: "medium" }}</span>
        </li>
      </ul>
    </div>
    <div class="col-12 md:col-6">
      <mgl-map
        [style]="'mapbox://styles/mapbox/streets-v12'"
        [zoom]="[15]"
        [center]="[1, 1]"
      >
        <!-- TODO -->
        <mgl-control mglNavigation></mgl-control>
        <mgl-marker #marker [lngLat]="[1, 1]"></mgl-marker>
        <mgl-popup [marker]="marker">{{ merchant.merchantStores[0].name }}</mgl-popup>
      </mgl-map>
    </div>
  </div>
  <ng-container *ngIf="merchant.merchantUsers">
    <p-divider></p-divider>
    <h3>Members</h3>
    <p-table [value]="merchant.merchantUsers" [tableStyle]="{ 'min-width': '50rem' }" styleClass="p-datatable-sm">
      <ng-template pTemplate="header">
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Role</th>
          <th>Added on</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-merchantUser>
        <tr>
          <td>{{ merchantUser.user.id }}</td>
          <td>{{ merchantUser.user.username }}</td>
          <td>{{ merchantUser.roles | role }}</td>
          <td>{{ merchantUser.createdOn | date: "medium" }}</td>
        </tr>
      </ng-template>
    </p-table>
  </ng-container>
  <ng-container *ngIf="merchant.merchantStores">
    <p-divider></p-divider>
    <h3>Stores</h3>
    <ul class="list-none m-0 p-0" *ngFor="let merchantStore of merchant.merchantStores">
      <h4>{{ merchantStore.name }}</h4>
      <li class="flex flex-wrap my-2">
        <span class="text-800 w-4 md:w-2">Identifier</span>
        <span>{{ merchantStore.identifier }}</span>
      </li>
      <li class="flex flex-wrap my-2">
        <span class="text-800 w-4 md:w-2">Website</span>
        <span><a class="no-underline" [href]="merchantStore.website" target="_blank">{{ merchantStore.website || '-' }}</a></span>
      </li>
      <li class="flex flex-wrap my-2">
        <span class="text-800 w-4 md:w-2">Telephone</span>
        <span>{{ merchantStore.telephone || '-' }}</span>
      </li>
      <li class="flex flex-wrap my-2">
        <span class="text-800 w-4 md:w-2">Address</span>
        <span>{{ merchantStore.address || '-' }}</span>
      </li>
      <li class="flex flex-wrap my-2">
        <span class="text-800 w-4 md:w-2">Postal Code</span>
        <span>{{ merchantStore.postCode || '-' }}</span>
      </li>
      <li class="flex flex-wrap my-2">
        <span class="text-800 w-4 md:w-2">Active</span>
        <span>{{ merchantStore.isActive }}</span>
      </li>
      <li class="flex flex-wrap my-2">
        <span class="text-800 w-4 md:w-2">Created by</span>
        <span>{{ merchantStore.createdBy?.username }}</span>
      </li>
      <li class="flex flex-wrap my-2">
        <span class="text-800 w-4 md:w-2">Created on</span>
        <span>{{ merchantStore.createdOn | date: "medium" }}</span>
      </li>
      <li class="flex flex-wrap my-2">
        <span class="text-800 w-4 md:w-2">Updated on</span>
        <span>{{ merchantStore.updatedOn | date: "medium" }}</span>
      </li>
    </ul>
  </ng-container>
</ng-container>
